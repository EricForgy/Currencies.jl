<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Rounding - Currencies.jl</title>
      
      
      
      
        <meta name="author" content="Fengyang Wang">
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Currencies.jl">
    <meta property="og:image" content="None/../">
    <meta name="apple-mobile-web-app-title" content="Currencies.jl">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../None">
    <link rel="icon" type="image/x-icon" href="../None">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-0dac3e5884.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../assets/Documenter.css">
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Manual <i class="icon icon-link"></i>
              
            
          </span>
        
        Rounding
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/JuliaFinance/Currencies.jl" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Currencies.jl
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          JuliaFinance/Currencies.jl
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/JuliaFinance/Currencies.jl/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/JuliaFinance/Currencies.jl/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Manual</span>
    <ul>
      
        
  <li>
    <a class="" title="Installation & Usage" href="../install/">
      Installation & Usage
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Valuation" href="../valuation/">
      Valuation
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Display & Formatting" href="../display/">
      Display & Formatting
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Custom Currencies" href="../custom/">
      Custom Currencies
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Rounding" href="./">
      Rounding
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Custom Precision" href="#custom-precision">
                Custom Precision
              </a>
            </li>
          
            <li class="anchor">
              <a title="Special Metals" href="#special-metals">
                Special Metals
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Notes on Performance" href="../performance/">
      Notes on Performance
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Reference" href="../reference/">
      Reference
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <p><a id='Rounding-1'></a></p>
<h1 id="rounding">Rounding</h1>
<p>Although the goal of this package is to provide integer operations on monetary amounts, in practice, decimal operations are unavoidable. For instance, there is no good way to compute interest or commissions with just integer arithmetic. By default, this package enables multiplying and dividing <code>Basket</code> and <code>Monetary</code> objects with all numbers descending from <code>Real</code>, including floating points. In fact, the recommended way to construct <code>Monetary</code> objects is by implicit floating point multiplication. This isn't a problem unless the floating point numbers are so big that floating points lose precision::</p>
<div class="codehilite"><pre><span></span><span class="p">@</span><span class="n">usingcurrencies</span> <span class="n">USD</span>
<span class="mf">90071992547409.91</span><span class="n">USD</span>  <span class="c"># 90071992547409.91 USD</span>
<span class="mf">90071992547409.92</span><span class="n">USD</span>  <span class="c"># 90071992547409.92 USD</span>
<span class="mf">90071992547409.93</span><span class="n">USD</span>  <span class="c"># 90071992547409.94 USD (!!)</span>
</pre></div>


<p>If you intend to use numbers of that size, and you actually care about the very small relative error, then there are several solutions::</p>
<div class="codehilite"><pre><span></span><span class="p">@</span><span class="n">usingcurrencies</span> <span class="n">USD</span>
<span class="n">parse</span><span class="p">(</span><span class="n">BigFloat</span><span class="p">,</span> <span class="s">&quot;90071992547409.93&quot;</span><span class="p">)</span><span class="n">USD</span>  <span class="c"># 90071992547409.93 USD</span>
<span class="n">Monetary</span><span class="p">(:</span><span class="n">USD</span><span class="p">,</span> <span class="mi">9007199254740993</span><span class="p">)</span>         <span class="c"># 90071992547409.93 USD</span>
</pre></div>


<p>Multiplication by arbitrary reals is useful, but there are some caveats. Firstly, be aware of rounding. By default, this package rounds to the nearest smallest denomination. Normally, this is not a problem. These rounding errors can pile up over time, however. Consider the following example:</p>
<div class="codehilite"><pre><span></span><span class="p">@</span><span class="n">usingcurrencies</span> <span class="n">USD</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">π</span> <span class="o">*</span> <span class="n">USD</span>    <span class="c"># 3.14 USD</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">π</span> <span class="o">*</span> <span class="n">a</span>      <span class="c"># 9.86 USD</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">π</span><span class="o">^</span><span class="mi">2</span> <span class="o">*</span> <span class="n">USD</span>  <span class="c"># 9.87 USD (!!)</span>
</pre></div>


<p>There is no single way to fix this problem, because depending on the situation that you want to model, the solution is different. One thing that helps in some circumstances is being able to specify the rounding method, or being able to do the calculations yourself. This package provides only the most useful rounding method, which is Julia's built-in <code>round</code>. To do a different rounding method, you must perform the calculations yourself, on a real type of your choice, by temporarily "taking apart" the data, and converting it back when it needs to be rounded (note that here, you're in charge of how to round the data). For example:</p>
<div class="codehilite"><pre><span></span><span class="p">@</span><span class="n">usingcurrencies</span> <span class="n">USD</span>
<span class="n">money</span> <span class="o">=</span> <span class="mi">1</span><span class="n">USD</span>                   <span class="c"># 1 USD</span>
<span class="n">magn</span> <span class="o">=</span> <span class="n">money</span><span class="o">.</span><span class="n">val</span>               <span class="c"># 100</span>
<span class="n">symb</span> <span class="o">=</span> <span class="n">currency</span><span class="p">(</span><span class="n">money</span><span class="p">)</span>         <span class="c"># :USD</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">π</span> <span class="o">*</span> <span class="n">magn</span>                   <span class="c"># 314.159265...</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">π</span> <span class="o">*</span> <span class="n">a</span>                      <span class="c"># 986.960440...</span>
<span class="n">Monetary</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>  <span class="c"># 9.87 USD</span>
</pre></div>


<p><a id='Custom-Precision-1'></a></p>
<h2 id="custom-precision">Custom Precision</h2>
<p>The default precision for most currencies is down to the minor currency unit. For example, for the United States dollar, this minor currency unit is the cent. This is acceptable for most purposes, but in some situations more or less precision is necessary. The precision (the number of decimal points after the major currency unit) can be controlled as a third type parameter to <code>Monetary</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">USD_M</span> <span class="o">=</span> <span class="n">Monetary</span><span class="p">{:</span><span class="n">USD</span><span class="p">,</span> <span class="kt">Int</span><span class="p">,</span> <span class="mi">3</span><span class="p">}(</span><span class="mi">1000</span><span class="p">)</span>
<span class="mf">1.000</span> <span class="n">USD</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">julia</span><span class="o">&gt;</span> <span class="mi">10</span><span class="n">USD_M</span> <span class="o">+</span> <span class="mf">11.004</span><span class="n">USD_M</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">UndefVarError</span><span class="p">:</span> <span class="n">julia</span> <span class="n">not</span> <span class="n">defined</span>
</pre></div>


<p>Sometimes it is useful to override the second parameter too, to change the underlying storage precision:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">USD_M</span> <span class="o">=</span> <span class="n">Monetary</span><span class="p">{:</span><span class="n">USD</span><span class="p">,</span> <span class="n">Int128</span><span class="p">,</span> <span class="mi">3</span><span class="p">}(</span><span class="mi">1000</span><span class="p">)</span>
<span class="mf">1.000</span> <span class="n">USD</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="mi">1267650600228229401496703205376</span><span class="n">USD_M</span>
<span class="mf">1267650600228229401496703205376.000</span> <span class="n">USD</span>
</pre></div>


<p>Mixed arithmetic between precisions and representations is supported. However, it's important to note that mixed arithmetic may have significant performance implications. This is because for type safety, many combinations are converted unnecessarily to <code>BigInt</code> as an internal representation:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">USD_M</span> <span class="o">+</span> <span class="n">USD</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">UndefVarError</span><span class="p">:</span> <span class="n">USD</span> <span class="n">not</span> <span class="n">defined</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">dump</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
<span class="o">$</span><span class="mf">100.00</span>\<span class="p">,</span>\<span class="n">mathrm</span><span class="p">{</span><span class="n">USD</span><span class="p">}</span><span class="o">$</span><span class="n">Currencies</span><span class="o">.</span><span class="n">CurrenciesBase</span><span class="o">.</span><span class="n">Monetary</span><span class="p">{:</span><span class="n">USD</span><span class="p">,</span><span class="n">Int128</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
  <span class="n">val</span><span class="p">:</span> <span class="n">Int128</span> <span class="mi">1267650600228229401496703205376000</span>
</pre></div>


<p>In some situations, it may be better to implement these conversions manually.</p>
<p><a id='Special-Metals-1'></a></p>
<h2 id="special-metals">Special Metals</h2>
<p>Some "currencies", like XAU (gram of gold), have no sensible minor unit. For these currencies, the precision must be provided manually:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="p">@</span><span class="n">usingcurrencies</span> <span class="n">XAU</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">ArgumentError</span><span class="p">:</span> <span class="n">Must</span> <span class="n">provide</span> <span class="n">precision</span> <span class="k">for</span> <span class="n">currency</span> <span class="n">XAU</span><span class="o">.</span>
 <span class="k">in</span> <span class="n">Monetary</span> <span class="n">at</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">Currencies</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">monetary</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span>
 <span class="k">in</span> <span class="n">eval</span> <span class="n">at</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">263</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="kd">const</span> <span class="n">XAU</span> <span class="o">=</span> <span class="n">Monetary</span><span class="p">(:</span><span class="n">XAU</span><span class="p">;</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
 <span class="mf">1.0000</span> <span class="n">XAU</span>
</pre></div>


<p>The usual caveats apply—be careful not to mix two different precisions of this currency. Otherwise, it can now be used like any other currency.</p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../custom/" title="Custom Currencies">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Custom Currencies
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../performance/" title="Notes on Performance">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Notes on Performance
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'JuliaFinance/Currencies.jl';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
      <script src="../assets/mathjaxhelper.js"></script>
    
    
  </body>
</html>