
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Simple checked currencies for Julia">
      
      
      
        <meta name="author" content="Fengyang Wang">
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.3">
    
    
      
        <title>Rounding - Currencies.jl</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-e2807e330f.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../assets/Documenter.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Currencies.jl" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Manual
                </span>
              
            
            Rounding
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/JuliaFinance/Currencies.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Currencies.jl
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/JuliaFinance/Currencies.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Manual
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Installation & Usage" class="md-nav__link">
      Installation & Usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../valuation/" title="Valuation" class="md-nav__link">
      Valuation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../display/" title="Display & Formatting" class="md-nav__link">
      Display & Formatting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom/" title="Custom Currencies" class="md-nav__link">
      Custom Currencies
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Rounding
      </label>
    
    <a href="./" title="Rounding" class="md-nav__link md-nav__link--active">
      Rounding
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#custom-precision" title="Custom Precision" class="md-nav__link">
    Custom Precision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-metals" title="Special Metals" class="md-nav__link">
    Special Metals
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../performance/" title="Notes on Performance" class="md-nav__link">
      Notes on Performance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reference/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#custom-precision" title="Custom Precision" class="md-nav__link">
    Custom Precision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-metals" title="Special Metals" class="md-nav__link">
    Special Metals
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/JuliaFinance/Currencies.jl/edit/master/docs/rounding.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <p><a id='Rounding-1'></a></p>
<h1 id="rounding">Rounding</h1>
<p>Although the goal of this package is to provide integer operations on monetary amounts, in practice, decimal operations are unavoidable. For instance, there is no good way to compute interest or commissions with just integer arithmetic. By default, this package enables multiplying and dividing <code>Basket</code> and <code>Monetary</code> objects with all numbers descending from <code>Real</code>, including floating points. In fact, the recommended way to construct <code>Monetary</code> objects is by implicit floating point multiplication. This isn't a problem unless the floating point numbers are so big that floating points lose precision::</p>
<div class="codehilite"><pre><span></span><span class="nd">@usingcurrencies</span> <span class="n">USD</span>
<span class="mf">90071992547409.91</span><span class="n">USD</span>  <span class="c"># 90071992547409.91 USD</span>
<span class="mf">90071992547409.92</span><span class="n">USD</span>  <span class="c"># 90071992547409.92 USD</span>
<span class="mf">90071992547409.93</span><span class="n">USD</span>  <span class="c"># 90071992547409.94 USD (!!)</span>
</pre></div>


<p>If you intend to use numbers of that size, and you actually care about the very small relative error, then there are several solutions::</p>
<div class="codehilite"><pre><span></span><span class="nd">@usingcurrencies</span> <span class="n">USD</span>
<span class="n">parse</span><span class="p">(</span><span class="kt">BigFloat</span><span class="p">,</span> <span class="s">&quot;90071992547409.93&quot;</span><span class="p">)</span><span class="n">USD</span>  <span class="c"># 90071992547409.93 USD</span>
<span class="n">Monetary</span><span class="p">(</span><span class="o">:</span><span class="n">USD</span><span class="p">,</span> <span class="mi">9007199254740993</span><span class="p">)</span>         <span class="c"># 90071992547409.93 USD</span>
</pre></div>


<p>Multiplication by arbitrary reals is useful, but there are some caveats. Firstly, be aware of rounding. By default, this package rounds to the nearest smallest denomination. Normally, this is not a problem. These rounding errors can pile up over time, however. Consider the following example:</p>
<div class="codehilite"><pre><span></span><span class="nd">@usingcurrencies</span> <span class="n">USD</span>
<span class="n">a</span> <span class="o">=</span> <span class="nb">π</span> <span class="o">*</span> <span class="n">USD</span>    <span class="c"># 3.14 USD</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">π</span> <span class="o">*</span> <span class="n">a</span>      <span class="c"># 9.86 USD</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">π</span><span class="o">^</span><span class="mi">2</span> <span class="o">*</span> <span class="n">USD</span>  <span class="c"># 9.87 USD (!!)</span>
</pre></div>


<p>There is no single way to fix this problem, because depending on the situation that you want to model, the solution is different. One thing that helps in some circumstances is being able to specify the rounding method, or being able to do the calculations yourself. This package provides only the most useful rounding method, which is Julia's built-in <code>round</code>. To do a different rounding method, you must perform the calculations yourself, on a real type of your choice, by temporarily "taking apart" the data, and converting it back when it needs to be rounded (note that here, you're in charge of how to round the data). For example:</p>
<div class="codehilite"><pre><span></span><span class="nd">@usingcurrencies</span> <span class="n">USD</span>
<span class="n">money</span> <span class="o">=</span> <span class="mi">1</span><span class="n">USD</span>                     <span class="c"># 1 USD</span>
<span class="n">magn</span> <span class="o">=</span> <span class="n">money</span><span class="o">.</span><span class="n">val</span>                 <span class="c"># 1.00</span>
<span class="n">symb</span> <span class="o">=</span> <span class="n">currency</span><span class="p">(</span><span class="n">money</span><span class="p">)</span>           <span class="c"># :USD</span>
<span class="n">a</span> <span class="o">=</span> <span class="nb">π</span><span class="o">^</span><span class="mi">2</span> <span class="o">*</span> <span class="n">magn</span>                   <span class="c"># 9.86960440...</span>
<span class="n">Monetary</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="mi">100</span><span class="n">a</span><span class="p">))</span> <span class="c"># 9.87 USD</span>
</pre></div>


<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>.val</code> field access is expected to be deprecated in the future. It is highly recommended that it not be used. A better replacement will become available in the future.</p>
</div>
<p><a id='Custom-Precision-1'></a></p>
<h2 id="custom-precision">Custom Precision</h2>
<p>The default precision for most currencies is down to the minor currency unit. For example, for the United States dollar, this minor currency unit is the cent. This is acceptable for most purposes, but in some situations more or less precision is necessary. The precision (the number of decimal points after the major currency unit) can be controlled as a third type parameter to <code>Monetary</code>:</p>
<div class="codehilite"><pre><span></span>julia&gt; USD_M = Monetary{:USD, Int, 3}(1000)
1.000 USD

julia&gt; julia&gt; 10USD_M + 11.004USD_M
ERROR: UndefVarError: julia not defined
</pre></div>


<p>Sometimes it is useful to override the second parameter too, to change the underlying storage precision:</p>
<div class="codehilite"><pre><span></span>julia&gt; USD_M = Monetary{:USD, Int128, 3}(1000)
1.000 USD

julia&gt; 1267650600228229401496703205376USD_M
1267650600228229401496703205376.000 USD
</pre></div>


<p>Mixed arithmetic between precisions and representations is supported. However, it's important to note that mixed arithmetic may have significant performance implications. This is because for type safety, many combinations are converted unnecessarily to <code>BigInt</code> as an internal representation:</p>
<div class="codehilite"><pre><span></span>julia&gt; USD_M + USD
ERROR: UndefVarError: USD not defined

julia&gt; dump(ans)
Currencies.CurrenciesBase.Monetary{:USD,Int128,3}
  val: FixedPointDecimals.FixedDecimal{Int128,3}
    i: Int128 1267650600228229401496703205376000
</pre></div>


<p>In some situations, it may be better to implement these conversions manually.</p>
<p><a id='Special-Metals-1'></a></p>
<h2 id="special-metals">Special Metals</h2>
<p>Some "currencies", like XAU (gram of gold), have no sensible minor unit. For these currencies, the precision must be provided manually:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@usingcurrencies</span> <span class="n">XAU</span>
<span class="n">ERROR</span><span class="o">:</span> <span class="kt">ArgumentError</span><span class="o">:</span> <span class="n">Must</span> <span class="n">provide</span> <span class="n">precision</span> <span class="k">for</span> <span class="n">currency</span> <span class="n">XAU</span><span class="o">.</span>
 <span class="kp">in</span> <span class="n">Monetary</span> <span class="n">at</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">Currencies</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">monetary</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">47</span>
 <span class="kp">in</span> <span class="n">eval</span> <span class="n">at</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">263</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="kd">const</span> <span class="n">XAU</span> <span class="o">=</span> <span class="n">Monetary</span><span class="p">(</span><span class="o">:</span><span class="n">XAU</span><span class="p">;</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
 <span class="mf">1.0000</span> <span class="n">XAU</span>
</pre></div>


<p>The usual caveats apply—be careful not to mix two different precisions of this currency. Otherwise, it can now be used like any other currency.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../custom/" title="Custom Currencies" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Custom Currencies
              </span>
            </div>
          </a>
        
        
          <a href="../performance/" title="Notes on Performance" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Notes on Performance
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright © 2015–2016 Fengyang Wang and other contributors
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-6b4ff16fa7.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../assets/mathjaxhelper.js"></script>
      
    
    
      
    
  </body>
</html>